<div class="register-container">
  <div class="register-card">
    <div class="register-header">
      <h2>Crear Cuenta Nueva</h2>
      <p>Complete el formulario para registrarse en VIAS-UC</p>
    </div>

    <mat-stepper linear #stepper>
      <!-- Paso 1: Datos Personales -->
      <mat-step [stepControl]="datosPersonalesForm" [editable]="true">
        <form [formGroup]="datosPersonalesForm">
          <ng-template matStepLabel>Datos Personales</ng-template>
          
          <div class="form-section">
            <h3>Tipo de Usuario</h3>
            <div class="tipo-usuario-buttons">
              <button type="button" mat-raised-button 
                      [color]="tipoUsuario === 'EMPLEADOR' ? 'primary' : ''"
                      (click)="onTipoUsuarioChange('EMPLEADOR')">
                <mat-icon>business</mat-icon>
                Empleador
              </button>
              <button type="button" mat-raised-button 
                      [color]="tipoUsuario === 'ESTUDIANTE' ? 'primary' : ''"
                      (click)="onTipoUsuarioChange('ESTUDIANTE')">
                <mat-icon>school</mat-icon>
                Estudiante
              </button>
              <button type="button" mat-raised-button 
                      [color]="tipoUsuario === 'EGRESADO' ? 'primary' : ''"
                      (click)="onTipoUsuarioChange('EGRESADO')">
                <mat-icon>work</mat-icon>
                Egresado
              </button>
            </div>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nombre</mat-label>
              <input matInput formControlName="nombre" placeholder="Ingrese su nombre">
              <mat-icon matPrefix>person</mat-icon>
              <mat-error>{{getErrorMessage(datosPersonalesForm, 'nombre')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Apellido</mat-label>
              <input matInput formControlName="apellido" placeholder="Ingrese su apellido">
              <mat-icon matPrefix>person</mat-icon>
              <mat-error>{{getErrorMessage(datosPersonalesForm, 'apellido')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" placeholder="ejemplo@correo.com">
              <mat-icon matPrefix>email</mat-icon>
              <mat-error>{{getErrorMessage(datosPersonalesForm, 'email')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Teléfono</mat-label>
              <input matInput formControlName="telefono" placeholder="0981234567">
              <mat-icon matPrefix>phone</mat-icon>
              <mat-error>{{getErrorMessage(datosPersonalesForm, 'telefono')}}</mat-error>
              <mat-hint>Solo números, sin espacios ni guiones</mat-hint>
            </mat-form-field>
          </div>

          <div class="step-actions">
            <button mat-button (click)="onCancelar()">Cancelar</button>
            <button mat-raised-button color="primary" matStepperNext 
                    [disabled]="!datosPersonalesForm.valid">
              Siguiente
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </form>
      </mat-step>

      <!-- Paso 2: Datos de Empresa (solo para Empleador) -->
      <mat-step [stepControl]="datosEmpresaForm" [editable]="true" *ngIf="tipoUsuario === 'EMPLEADOR'">
        <form [formGroup]="datosEmpresaForm">
          <ng-template matStepLabel>Datos de Empresa</ng-template>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nombre de la Empresa</mat-label>
              <input matInput formControlName="nombreEmpresa" placeholder="Ingrese el nombre de la empresa">
              <mat-icon matPrefix>business</mat-icon>
              <mat-error>{{getErrorMessage(datosEmpresaForm, 'nombreEmpresa')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>RUC</mat-label>
              <input matInput formControlName="ruc" placeholder="80000000-0">
              <mat-icon matPrefix>badge</mat-icon>
              <mat-error>{{getErrorMessage(datosEmpresaForm, 'ruc')}}</mat-error>
              <mat-hint>RUC de la empresa (formato: 80000000-0)</mat-hint>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Razón Social</mat-label>
              <input matInput formControlName="razonSocial" placeholder="Razón social de la empresa">
              <mat-icon matPrefix>description</mat-icon>
              <mat-error>{{getErrorMessage(datosEmpresaForm, 'razonSocial')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Teléfono de Contacto</mat-label>
              <input matInput formControlName="contacto" placeholder="0981234567">
              <mat-icon matPrefix>phone</mat-icon>
              <mat-error>{{getErrorMessage(datosEmpresaForm, 'contacto')}}</mat-error>
              <mat-hint>Teléfono de la empresa (8-15 dígitos)</mat-hint>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Ubicación</mat-label>
              <input matInput formControlName="ubicacion" placeholder="Asunción">
              <mat-icon matPrefix>location_on</mat-icon>
              <mat-error>{{getErrorMessage(datosEmpresaForm, 'ubicacion')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email de la Empresa</mat-label>
              <input matInput type="email" formControlName="email" placeholder="contacto@empresa.com">
              <mat-icon matPrefix>email</mat-icon>
              <mat-error>{{getErrorMessage(datosEmpresaForm, 'email')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Tu Rol en la Empresa</mat-label>
              <input matInput formControlName="rolEnEmpresa" placeholder="Ej: Gerente de RRHH">
              <mat-icon matPrefix>work</mat-icon>
              <mat-error>{{getErrorMessage(datosEmpresaForm, 'rolEnEmpresa')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="step-actions">
            <button mat-button matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
              Atrás
            </button>
            <button mat-raised-button color="primary" matStepperNext 
                    [disabled]="!datosEmpresaForm.valid">
              Siguiente
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </form>
      </mat-step>

      <!-- Paso 3: Seguridad -->
      <mat-step [stepControl]="seguridadForm" [editable]="true">
        <form [formGroup]="seguridadForm">
          <ng-template matStepLabel>Seguridad</ng-template>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Contraseña</mat-label>
              <input matInput [type]="hidePassword ? 'password' : 'text'" 
                     formControlName="password" placeholder="Ingrese su contraseña">
              <mat-icon matPrefix>lock</mat-icon>
              <button mat-icon-button matSuffix type="button" 
                      (click)="hidePassword = !hidePassword">
                <mat-icon>{{hidePassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
            </mat-form-field>
          </div>

          <!-- Indicadores de fortaleza de contraseña -->
          <div class="password-requirements" *ngIf="seguridadForm.get('password')?.touched">
            <p class="requirements-title">La contraseña debe cumplir:</p>
            <ul class="requirements-list">
              <li *ngFor="let error of getPasswordErrors()" class="error-item">
                <mat-icon>close</mat-icon>
                {{error}}
              </li>
              <li *ngIf="getPasswordErrors().length === 0" class="success-item">
                <mat-icon>check_circle</mat-icon>
                Contraseña segura
              </li>
            </ul>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirmar Contraseña</mat-label>
              <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" 
                     formControlName="confirmPassword" placeholder="Confirme su contraseña">
              <mat-icon matPrefix>lock</mat-icon>
              <button mat-icon-button matSuffix type="button" 
                      (click)="hideConfirmPassword = !hideConfirmPassword">
                <mat-icon>{{hideConfirmPassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
              <mat-error *ngIf="!passwordsMatch()">Las contraseñas no coinciden</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-checkbox formControlName="aceptaTerminos" class="terms-checkbox">
              Acepto los <a href="/terminos" target="_blank">Términos y Condiciones</a> 
              y la <a href="/privacidad" target="_blank">Política de Privacidad</a>
            </mat-checkbox>
            <mat-error *ngIf="seguridadForm.get('aceptaTerminos')?.touched && 
                              seguridadForm.get('aceptaTerminos')?.hasError('required')">
              Debe aceptar los términos y condiciones
            </mat-error>
          </div>

          <div class="step-actions">
            <button mat-button matStepperPrevious>
              <mat-icon>arrow_back</mat-icon>
              Atrás
            </button>
            <button mat-raised-button color="primary" 
                    (click)="onSubmit()" 
                    [disabled]="!seguridadForm.valid || isLoading">
              <mat-spinner diameter="20" *ngIf="isLoading"></mat-spinner>
              <span *ngIf="!isLoading">
                <mat-icon>person_add</mat-icon>
                Registrarse
              </span>
            </button>
          </div>
        </form>
      </mat-step>
    </mat-stepper>

    <div class="register-footer">
      <p>¿Ya tienes una cuenta? <a (click)="onCancelar()" class="link-login">Iniciar Sesión</a></p>
    </div>
  </div>
</div>
