<div class="busqueda-container">
  <!-- ========== HEADER ========== -->
  <header class="busqueda-header">
    <div class="header-top">
      <button class="btn-back" (click)="volver()">
        â† Volver
      </button>
      <h1>Buscar Candidatos</h1>
      <button class="btn-logout" (click)="logout()">
        Cerrar SesiÃ³n
      </button>
    </div>
    
    <!-- Barra de bÃºsqueda -->
    <div class="search-bar-container">
      <div class="search-bar">
        <span class="search-icon">ğŸ”</span>
        <input 
          type="text"
          placeholder="Buscar por nombre, apellido o habilidad..."
          [(ngModel)]="searchText"
          (ngModelChange)="onSearchTextChange($event)"
          (keyup.enter)="buscarInmediato()">
        <button 
          *ngIf="searchText" 
          class="btn-clear-search" 
          (click)="clearSearch()">
          âœ•
        </button>
      </div>
    </div>
  </header>

  <!-- ========== CONTENIDO PRINCIPAL ========== -->
  <div class="busqueda-main">
    <div class="busqueda-content">
      
      <!-- PANEL DE FILTROS (IZQUIERDA) -->
      <aside class="filters-panel" [class.collapsed]="filtersPanelCollapsed">
        <div class="filters-header">
          <h2>Filtros</h2>
          <button class="btn-toggle-filters" (click)="toggleFiltersPanel()">
            {{ filtersPanelCollapsed ? 'â˜°' : 'âœ•' }}
          </button>
        </div>

        <form [formGroup]="filtrosForm" *ngIf="!filtersPanelCollapsed">
          <!-- Tipo de Perfil -->
          <div class="filter-group">
            <h3>Tipo de Perfil</h3>
            <label>
              <input 
                type="checkbox" 
                [checked]="isTipoPerfilSelected('PORTAFOLIO')"
                (change)="onTipoPerfilChange($event, 'PORTAFOLIO')">
              Portafolio
            </label>
            <label>
              <input 
                type="checkbox" 
                [checked]="isTipoPerfilSelected('ESTUDIANTE')"
                (change)="onTipoPerfilChange($event, 'ESTUDIANTE')">
              Estudiante
            </label>
            <label>
              <input 
                type="checkbox" 
                [checked]="isTipoPerfilSelected('EGRESADO')"
                (change)="onTipoPerfilChange($event, 'EGRESADO')">
              Egresado
            </label>
          </div>

          <!-- Carrera -->
          <div class="filter-group">
            <h3>Carrera</h3>
            <select formControlName="carrera">
              <option value="">Todas las carreras</option>
              <option *ngFor="let carrera of filtrosDisponibles?.carreras" [value]="carrera">
                {{ carrera }}
              </option>
            </select>
          </div>

          <!-- UbicaciÃ³n -->
          <div class="filter-group">
            <h3>UbicaciÃ³n</h3>
            <select formControlName="ubicacion">
              <option value="">Todas las ubicaciones</option>
              <option *ngFor="let ubicacion of filtrosDisponibles?.ubicaciones" [value]="ubicacion">
                {{ ubicacion }}
              </option>
            </select>
          </div>

          <!-- Habilidades -->
          <div class="filter-group">
            <h3>Habilidades</h3>
            <input 
              type="text"
              formControlName="habilidades"
              placeholder="Ej: JavaScript, React">
          </div>

          <!-- Botones -->
          <div class="filtros-actions">
            <button type="button" class="btn-primary" (click)="aplicarFiltros()">
              Aplicar
            </button>
            <button type="button" class="btn-secondary" (click)="limpiarFiltros()">
              Limpiar
            </button>
          </div>
        </form>
      </aside>

      <!-- ÃREA DE RESULTADOS (DERECHA) -->
      <main class="results-area">
        
        <!-- Chips de filtros activos -->
        <div class="active-filters" *ngIf="filtrosActivos.length > 0">
          <span 
            *ngFor="let filtro of filtrosActivos" 
            class="filter-chip">
            {{ filtro.label }}
            <button class="remove-filter" (click)="removerFiltro(filtro)">âœ•</button>
          </span>
        </div>

        <!-- Header con ordenamiento -->
        <div class="resultados-header" *ngIf="busquedaRealizada && resultados.length > 0">
          <div class="resultados-count">
            <h2>Resultados</h2>
            <p>{{ resultados.length }} de {{ total }} candidatos</p>
          </div>
          <div class="sorting-controls">
            <label>Ordenar:</label>
            <select [(ngModel)]="ordenActual" (ngModelChange)="cambiarOrden()">
              <option value="relevancia">Relevancia</option>
              <option value="recientes">MÃ¡s recientes</option>
              <option value="rating">Mejor rating</option>
            </select>
          </div>
        </div>

        <!-- LOADING -->
        <div class="loading-overlay" *ngIf="cargando">
          <div class="loading-spinner">â³</div>
          <p>Buscando candidatos...</p>
        </div>

        <!-- SIN RESULTADOS -->
        <div class="sin-resultados" *ngIf="!cargando && busquedaRealizada && resultados.length === 0">
          <div class="icon">ğŸ”</div>
          <h3>No se encontraron resultados</h3>
          <p>Intenta ajustar los filtros o buscar algo diferente</p>
        </div>

        <!-- GRILLA DE RESULTADOS -->
        <div class="resultados-grid" *ngIf="!cargando && resultados.length > 0">
          <div *ngFor="let portafolio of resultados" class="portafolio-card">
            
            <!-- Header -->
            <div class="card-header">
              <div class="header-top">
                <h3>{{ portafolio.nombre }} {{ portafolio.apellido }}</h3>
                <span class="tipo-badge" [ngClass]="getTipoBadgeClass(portafolio.tipo || 'PORTAFOLIO')">
                  {{ getTipoBadge(portafolio.tipo || 'PORTAFOLIO') }}
                </span>
              </div>
              <div class="header-meta">
                <div class="meta-item" *ngIf="portafolio.carrera">
                  <span class="icon">ğŸ“</span>
                  <span>{{ portafolio.carrera }}</span>
                </div>
                <div class="meta-item" *ngIf="portafolio.ubicacion">
                  <span class="icon">ğŸ“</span>
                  <span>{{ portafolio.ubicacion }}</span>
                </div>
              </div>
            </div>

            <!-- Body -->
            <div class="card-body">
              <p class="descripcion" *ngIf="portafolio.descripcion">
                {{ portafolio.descripcion }}
              </p>
              
              <!-- Habilidades -->
              <div class="habilidades" *ngIf="portafolio.habilidades && portafolio.habilidades.length > 0">
                <span 
                  *ngFor="let skill of portafolio.habilidades.slice(0, 5)" 
                  class="skill-tag">
                  {{ skill }}
                </span>
                <span *ngIf="portafolio.habilidades.length > 5" class="skill-tag-more">
                  +{{ portafolio.habilidades.length - 5 }}
                </span>
              </div>

              <!-- Contacto -->
              <div class="contact-info" *ngIf="portafolio.mostrarContacto">
                <p *ngIf="portafolio.email">
                  <span class="icon">ğŸ“§</span>
                  {{ portafolio.email }}
                </p>
                <p *ngIf="portafolio.telefono">
                  <span class="icon">ğŸ“±</span>
                  {{ portafolio.telefono }}
                </p>
              </div>

              <button 
                class="btn-toggle-contact"
                (click)="toggleContacto(portafolio)">
                {{ portafolio.mostrarContacto ? 'â–² Ocultar' : 'â–¼ Ver contacto' }}
              </button>
            </div>

            <!-- Actions -->
            <div class="card-actions">
              <button class="btn-ver" (click)="verPortafolio(portafolio)">
                <span class="icon">ğŸ‘ï¸</span>
                <span>Ver</span>
              </button>
              
              <button 
                class="btn-guardar"
                [class.saved]="portafolio.guardado"
                (click)="guardarPortafolio(portafolio)">
                <span class="icon">{{ portafolio.guardado ? 'â¤ï¸' : 'ğŸ¤' }}</span>
                <span>{{ portafolio.guardado ? 'Guardado' : 'Guardar' }}</span>
              </button>
              
              <button class="btn-invitar" (click)="invitarPostular(portafolio)">
                <span class="icon">âœ‰ï¸</span>
                <span>Invitar</span>
              </button>
              
              <button class="btn-descargar" (click)="descargarPerfil(portafolio, $event)">
                <span class="icon">ğŸ“¥</span>
                <span>Descargar</span>
              </button>
              
              <button class="btn-mensaje" (click)="enviarMensaje(portafolio)">
                <span class="icon">ğŸ’¬</span>
                <span>Mensaje</span>
              </button>
            </div>
          </div>
        </div>

        <!-- PAGINACIÃ“N -->
        <div class="paginacion" *ngIf="!cargando && totalPaginas > 1">
          <button [disabled]="paginaActual === 1" (click)="paginaAnterior()">
            â† Anterior
          </button>
          
          <span class="pag-info">
            PÃ¡gina {{ paginaActual }} de {{ totalPaginas }}
          </span>
          
          <button [disabled]="paginaActual === totalPaginas" (click)="paginaSiguiente()">
            Siguiente â†’
          </button>
        </div>

      </main>
    </div>
  </div>
</div>
